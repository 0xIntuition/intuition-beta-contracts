<!DOCTYPE HTML>
<html lang="en" class="dark sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ProgressiveCurve - Intuition Beta Contracts Documentation</title>


        <!-- Custom HTML head -->
        <!-- Include Mermaid -->
        <script src='https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js'></script>
        
        <!-- Include MathJax -->
        <script>
          window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true, processEnvironments: true }, options: { skipHtmlTags: ['script', 'noscript', 'style',
          'textarea', 'pre'] } };
        </script>
        <script
          type='text/javascript'
          id='MathJax-script'
          async
          src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
        >
        </script>
        
        <script>
          window.addEventListener('load', function() { mermaid.initialize({ startOnLoad: true, theme: 'dark', securityLevel:
          'loose', themeVariables: { darkMode: true }, flowchart: { htmlLabels: true, curve: 'basis', useMaxWidth: true }, zoom:
          { enabled: true, maxZoom: 10, minZoom: 0.1 }, menu: { enabled: true, showMenu: true, menuItems: [ { name: 'Zoom In',
          action: function() { mermaid.mermaidAPI.zoomIn(); } }, { name: 'Zoom Out', action: function() {
          mermaid.mermaidAPI.zoomOut(); } }, { name: 'Reset Zoom', action: function() { mermaid.mermaidAPI.reset(); } } ] } });
          });
        </script>
        
        <style>
          .mermaid { width: 100% !important; } /* Style the menu */ .mermaid-menu { background-color: #2d2d2d !important;
          border: 1px solid #444 !important; padding: 5px !important; border-radius: 4px !important; } .mermaid-menu-item {
          color: #fff !important; padding: 5px 10px !important; cursor: pointer !important; } .mermaid-menu-item:hover {
          background-color: #444 !important; }
        </style>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../book.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Intuition Beta Contracts Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/0xIntuition/intuition-beta-contracts" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="progressivecurve"><a class="header" href="#progressivecurve">ProgressiveCurve</a></h1>
<p><a href="https://github.com/0xIntuition/intuition-beta-contracts/blob/3fa150f73a1f1186d143287bdaf448b0d7231227/src/ProgressiveCurve.sol">Git Source</a></p>
<h2 id="curve-visualization"><a class="header" href="#curve-visualization">Curve Visualization</a></h2>
<pre class="mermaid">%%{init: {&quot;xychart&quot;: {&quot;showTitle&quot;: true}} }%%
</pre>
<pre class="mermaid">xychart-beta
    title &quot;Progressive Curve&quot;
    x-axis &quot;Assets (ETH)&quot; [0.000000000000000000, 1.000000000000000000, 2.000000000000000000, 3.000000000000000000, 4.000000000000000000, 5.000000000000000000, 6.000000000000000000, 7.000000000000000000, 8.000000000000000000, 9.000000000000000000, 10.000000000000000000, 11.000000000000000000, 12.000000000000000000, 13.000000000000000000, 14.000000000000000000, 15.000000000000000000, 16.000000000000000000, 17.000000000000000000, 18.000000000000000000, 19.000000000000000000, 20.000000000000000000, 21.000000000000000000, 22.000000000000000000, 23.000000000000000000, 24.000000000000000000, 25.000000000000000000, 26.000000000000000000, 27.000000000000000000, 28.000000000000000000, 29.000000000000000000, 30.000000000000000000, 31.000000000000000000, 32.000000000000000000, 33.000000000000000000, 34.000000000000000000, 35.000000000000000000, 36.000000000000000000, 37.000000000000000000, 38.000000000000000000, 39.000000000000000000, 40.000000000000000000, 41.000000000000000000, 42.000000000000000000, 43.000000000000000000, 44.000000000000000000, 45.000000000000000000, 46.000000000000000000, 47.000000000000000000, 48.000000000000000000, 49.000000000000000000, 50.000000000000000000, 51.000000000000000000, 52.000000000000000000, 53.000000000000000000, 54.000000000000000000, 55.000000000000000000, 56.000000000000000000, 57.000000000000000000, 58.000000000000000000, 59.000000000000000000, 60.000000000000000000, 61.000000000000000000, 62.000000000000000000, 63.000000000000000000, 64.000000000000000000, 65.000000000000000000, 66.000000000000000000, 67.000000000000000000, 68.000000000000000000, 69.000000000000000000, 70.000000000000000000, 71.000000000000000000, 72.000000000000000000, 73.000000000000000000, 74.000000000000000000, 75.000000000000000000, 76.000000000000000000, 77.000000000000000000, 78.000000000000000000, 79.000000000000000000, 80.000000000000000000, 81.000000000000000000, 82.000000000000000000, 83.000000000000000000, 84.000000000000000000, 85.000000000000000000, 86.000000000000000000, 87.000000000000000000, 88.000000000000000000, 89.000000000000000000, 90.000000000000000000, 91.000000000000000000, 92.000000000000000000, 93.000000000000000000, 94.000000000000000000, 95.000000000000000000, 96.000000000000000000, 97.000000000000000000, 98.000000000000000000, 99.000000000000000000]
    y-axis &quot;Shares&quot;
    line [0.000000000000000000, 0.000000028284271247, 0.000000040000000000, 0.000000048989794855, 0.000000056568542494, 0.000000063245553203, 0.000000069282032302, 0.000000074833147735, 0.000000080000000000, 0.000000084852813742, 0.000000089442719099, 0.000000093808315196, 0.000000097979589711, 0.000000101980390271, 0.000000105830052442, 0.000000109544511501, 0.000000113137084989, 0.000000116619037896, 0.000000120000000000, 0.000000123288280059, 0.000000126491106406, 0.000000129614813968, 0.000000132664991614, 0.000000135646599662, 0.000000138564064605, 0.000000141421356237, 0.000000144222051018, 0.000000146969384566, 0.000000149666295470, 0.000000152315462117, 0.000000154919333848, 0.000000157480157480, 0.000000160000000000, 0.000000162480768092, 0.000000164924225024, 0.000000167332005306, 0.000000169705627484, 0.000000172046505340, 0.000000174355957741, 0.000000176635217326, 0.000000178885438199, 0.000000181107702762, 0.000000183303027798, 0.000000185472369909, 0.000000187616630392, 0.000000189736659610, 0.000000191833260932, 0.000000193907194296, 0.000000195959179422, 0.000000197989898732, 0.000000200000000000, 0.000000201990098767, 0.000000203960780543, 0.000000205912602819, 0.000000207846096908, 0.000000209761769634, 0.000000211660104885, 0.000000213541565040, 0.000000215406592285, 0.000000217255609824, 0.000000219089023002, 0.000000220907220343, 0.000000222710574513, 0.000000224499443206, 0.000000226274169979, 0.000000228035085019, 0.000000229782505861, 0.000000231516738055, 0.000000233238075793, 0.000000234946802489, 0.000000236643191323, 0.000000238327505756, 0.000000240000000000, 0.000000241660919471, 0.000000243310501211, 0.000000244948974278, 0.000000246576560118, 0.000000248193472919, 0.000000249799919935, 0.000000251396101799, 0.000000252982212813, 0.000000254558441227, 0.000000256124969497, 0.000000257681974534, 0.000000259229627936, 0.000000260768096208, 0.000000262297540972, 0.000000263818119165, 0.000000265329983228, 0.000000266833281282, 0.000000268328157299, 0.000000269814751264, 0.000000271293199325, 0.000000272763633939, 0.000000274226184016, 0.000000275680975041, 0.000000277128129211, 0.000000278567765543, 0.000000280000000000, 0.000000281424945589]
</pre>
<p><strong>Inherits:</strong>
<a href="/src/BaseCurve.sol/abstract.BaseCurve.html">BaseCurve</a></p>
<p><strong>Author:</strong>
0xIntuition</p>
<p>🚀 Welcome to the SPICIEST bonding curve in the Intuition galaxy! While our LinearCurve
is out there playing it safe, the ProgressiveCurve is here to turn up the HEAT on
early staker rewards! 🌶️
This mathematical masterpiece uses a progressive pricing model where each new share
costs more than the last. The price follows the formula:
$$P(s) = m \cdot s$$
where $m$ is our slope (measured in basis points) and $s$ is the total supply of shares.
But wait, there's more! The actual cost to mint shares is calculated as the area under this
curve, giving us:
$$\text{Cost} = (s_2^2 - s_1^2) \cdot \frac{m}{2}$$
where $s_1$ is the starting share supply and $s_2$ is the final share supply. 📐
Why is this so 🔥? Because it creates a natural pyramid of value that HEAVILY favors
early stakers. The earlier you get in, the more your shares are worth compared to
later participants. It's like the LinearCurve's fee-based appreciation got injected
with pure rocket fuel! While fees still provide that sweet, sweet baseline appreciation,
the progressive curve adds an aggressive incentivization mechanism that makes early
staking absolutely JUICY. 💎
Think of it as DeFi's answer to the early bird special - except instead of getting
the worm, you're getting exponentially more valuable shares! The perfect complement
to our low-risk fee model, creating a two-pronged approach to value accrual that's
simply <em>chef's kiss</em> 👨‍🍳</p>
<p><em>Uses the prb-math library for performant, precise fixed point arithmetic with UD60x18</em></p>
<p><em>Fixed point precision used for all internal calculations, while return values are all
represented as regular uint256s, and unwrapped.  I.e. we might use 123.456 internally
and return 123.</em></p>
<p><em>The core equation:
$$P(s) = m \cdot s$$
and the cost equation:
$$\text{Cost} = (s_2^2 - s_1^2) \cdot \frac{m}{2}$$
comes from calculus - it's the integral of a linear price function. The area under a
linear curve from point $s_1$ to $s_2$ gives us the total cost/return of minting/redeeming
shares.</em></p>
<p><em>Inspired by the Solaxy.sol contract: https://github.com/M3tering/Solaxy/blob/main/src/Solaxy.sol
and https://m3tering.whynotswitch.com/token-economics/mint-and-distribution.  * The key difference
between the Solaxy contract and this one is that the economic state is handled by the EthMultiVault
instead of directly in the curve implementation. *  Otherwise the math is identical.</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="slope"><a class="header" href="#slope">SLOPE</a></h3>
<p>The slope of the curve, in basis points.  This is the rate at which the price of shares increases.</p>
<p><em>0.0025e18 -&gt; 25 basis points, 0.0001e18 = 1 basis point, etc etc</em></p>
<p><em>If minDeposit is 0.003 ether, this value would need to be 0.00007054e18 to avoid returning 0 shares for minDeposit assets</em></p>
<pre><code class="language-solidity">UD60x18 public immutable SLOPE;
</code></pre>
<h3 id="half_slope"><a class="header" href="#half_slope">HALF_SLOPE</a></h3>
<p>The half of the slope, used for calculations.</p>
<pre><code class="language-solidity">UD60x18 public immutable HALF_SLOPE;
</code></pre>
<h3 id="max_shares"><a class="header" href="#max_shares">MAX_SHARES</a></h3>
<p><em>Since powu(2) will overflow first (see slope equation), maximum totalShares is sqrt(MAX_UD60x18)</em></p>
<pre><code class="language-solidity">uint256 public immutable MAX_SHARES;
</code></pre>
<h3 id="max_assets"><a class="header" href="#max_assets">MAX_ASSETS</a></h3>
<p><em>The maximum assets is totalShares * slope / 2, because multiplication (see slope equation) would overflow beyond that point.</em></p>
<pre><code class="language-solidity">uint256 public immutable MAX_ASSETS;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p>Constructs a new ProgressiveCurve with the given name and slope</p>
<p><em>Computes maximum values given constructor arguments</em></p>
<p><em>Computes Slope / 2 as commonly used constant</em></p>
<pre><code class="language-solidity">constructor(string memory _name, uint256 slope18) BaseCurve(_name);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_name</code></td><td><code>string</code></td><td>The name of the curve (i.e. "Progressive Curve #465")</td></tr>
<tr><td><code>slope18</code></td><td><code>uint256</code></td><td>The slope of the curve, in basis points (i.e. 0.0025e18)</td></tr>
</tbody></table>
</div>
<h3 id="previewdeposit"><a class="header" href="#previewdeposit">previewDeposit</a></h3>
<p>Preview how many shares would be minted for a deposit of assets</p>
<p><em>Let $s$ = current total supply</em></p>
<p><em>Let $a$ = amount of assets to deposit</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>shares:
$$\text{shares} = \sqrt{s^2 + \frac{a}{m/2}} - s$$</em></p>
<p><em>or to say that another way:
$$\text{shares} = \sqrt{s^2 + \frac{2a}{m}} - s$$</em></p>
<pre><code class="language-solidity">function previewDeposit(uint256 assets, uint256, uint256 totalShares) public view override returns (uint256 shares);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>Quantity of assets to deposit</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The number of shares that would be minted</td></tr>
</tbody></table>
</div>
<h3 id="previewredeem"><a class="header" href="#previewredeem">previewRedeem</a></h3>
<p>Preview how many assets would be returned for burning a specific amount of shares</p>
<p><em>Let $s$ = initial total supply of shares</em></p>
<p><em>Let $r$ = shares to redeem</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>assets:
$$\text{assets} = (s^2 - (s-r)^2) \cdot \frac{m}{2}$$</em></p>
<p><em>this can be expanded to:
$$\text{assets} = (s^2 - (s^2 - 2sr + r^2)) \cdot \frac{m}{2}$$</em></p>
<p><em>which simplifies to:
$$\text{assets} = (2sr - r^2) \cdot \frac{m}{2}$$</em></p>
<pre><code class="language-solidity">function previewRedeem(uint256 shares, uint256 totalShares, uint256) public view override returns (uint256 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>Quantity of shares to burn</td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The number of assets that would be returned</td></tr>
</tbody></table>
</div>
<h3 id="previewmint"><a class="header" href="#previewmint">previewMint</a></h3>
<p>Preview how many assets would be required to mint a specific amount of shares</p>
<p><em>Let $s$ = current total supply of shares</em></p>
<p><em>Let $n$ = new shares to mint</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>assets:
$$\text{assets} = ((s + n)^2 - s^2) \cdot \frac{m}{2}$$</em></p>
<p><em>which can be expanded to:
$$\text{assets} = (s^2 + 2sn + n^2 - s^2) \cdot \frac{m}{2}$$</em></p>
<p><em>which simplifies to:
$$\text{assets} = (2sn + n^2) \cdot \frac{m}{2}$$</em></p>
<pre><code class="language-solidity">function previewMint(uint256 shares, uint256 totalShares, uint256) public view override returns (uint256 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>Quantity of shares to mint</td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The number of assets that would be required to mint the shares</td></tr>
</tbody></table>
</div>
<h3 id="previewwithdraw"><a class="header" href="#previewwithdraw">previewWithdraw</a></h3>
<p>Preview how many shares would be redeemed for a withdrawal of assets</p>
<p><em>Let $s$ = current total supply of shares</em></p>
<p><em>Let $a$ = assets to withdraw</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>shares:
$$\text{shares} = s - \sqrt{s^2 - \frac{a}{m/2}}$$</em></p>
<p><em>or to say that another way:
$$\text{shares} = s - \sqrt{s^2 - \frac{2a}{m}}$$</em></p>
<pre><code class="language-solidity">function previewWithdraw(uint256 assets, uint256, uint256 totalShares) public view override returns (uint256 shares);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>Quantity of assets to withdraw</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The number of shares that would need to be redeemed</td></tr>
</tbody></table>
</div>
<h3 id="currentprice"><a class="header" href="#currentprice">currentPrice</a></h3>
<p>Get the current price of a share</p>
<p><em>Let $s$ = current total supply of shares</em></p>
<p><em>Let $m$ = the slope of the curve</em></p>
<p><em>sharePrice:
$$\text{sharePrice} = s \cdot m$$</em></p>
<p><em>This is the basic linear price function where the price increases linearly with the total supply</em></p>
<p><em>And the slope ($m$) determines how quickly the price increases</em></p>
<p><em>TLDR: Each new share costs more than the last</em></p>
<pre><code class="language-solidity">function currentPrice(uint256 totalShares) public view override returns (uint256 sharePrice);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sharePrice</code></td><td><code>uint256</code></td><td>The current price of a share</td></tr>
</tbody></table>
</div>
<h3 id="converttoshares"><a class="header" href="#converttoshares">convertToShares</a></h3>
<p>Convert assets to shares at a specific point on the curve</p>
<p><em>Let $s$ = the current total supply of shares</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>Let $a$ = quantity of assets to convert to shares</em></p>
<p><em>shares:
$$\text{shares} = \frac{a}{s \cdot m/2}$$</em></p>
<p><em>Or to say that another way:
$$\text{shares} = \frac{2a}{s \cdot m}$$</em></p>
<pre><code class="language-solidity">function convertToShares(uint256 assets, uint256, uint256 totalShares) public view override returns (uint256 shares);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>Quantity of assets to convert to shares</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The number of shares equivalent to the given assets</td></tr>
</tbody></table>
</div>
<h3 id="converttoassets"><a class="header" href="#converttoassets">convertToAssets</a></h3>
<p>Convert shares to assets at a specific point on the curve</p>
<p><em>Let $s$ = current total supply of shares</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>Let $n$ = quantity of shares to convert to assets</em></p>
<p><em>conversion price:
$$\text{price} = s \cdot \frac{m}{2}$$</em></p>
<p><em>where $\frac{m}{2}$ is average price per share</em></p>
<p><em>assets:
$$\text{assets} = n \cdot (s \cdot \frac{m}{2})$$</em></p>
<p><em>Or to say that another way:
$$\text{assets} = n \cdot s \cdot \frac{m}{2}$$</em></p>
<pre><code class="language-solidity">function convertToAssets(uint256 shares, uint256 totalShares, uint256) public view override returns (uint256 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>Quantity of shares to convert to assets</td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The number of assets equivalent to the given shares</td></tr>
</tbody></table>
</div>
<h3 id="_converttoassets"><a class="header" href="#_converttoassets">_convertToAssets</a></h3>
<p>Computes assets as the area under a linear curve with a simplified form of the area of a trapezium:
$$f(x) = mx + c$$
$$\text{Area} = \frac{1}{2} \cdot (a + b) \cdot h$$
where $a$ and $b$ can be both $f(\text{juniorSupply})$ or $f(\text{seniorSupply})$ depending if used in minting or redeeming.
Calculates area as:
$$(\text{seniorSupply}^2 - \text{juniorSupply}^2) \cdot \text{halfSlope}$$
where:
$$\text{halfSlope} = \frac{\text{slope}}{2}$$</p>
<pre><code class="language-solidity">function _convertToAssets(UD60x18 juniorSupply, UD60x18 seniorSupply) internal view returns (UD60x18 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>juniorSupply</code></td><td><code>UD60x18</code></td><td>The smaller supply in the operation (the initial supply during mint, or the final supply during a redeem operation).</td></tr>
<tr><td><code>seniorSupply</code></td><td><code>UD60x18</code></td><td>The larger supply in the operation (the final supply during mint, or the initial supply during a redeem operation).</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>UD60x18</code></td><td>The computed assets as an instance of UD60x18 (a fixed-point number).</td></tr>
</tbody></table>
</div>
<h3 id="maxshares"><a class="header" href="#maxshares">maxShares</a></h3>
<p>The maximum number of shares that this curve can handle without overflowing.</p>
<p><em>Checked by the EthMultiVault before transacting</em></p>
<pre><code class="language-solidity">function maxShares() public view override returns (uint256);
</code></pre>
<h3 id="maxassets"><a class="header" href="#maxassets">maxAssets</a></h3>
<p>The maximum number of assets that this curve can handle without overflowing.</p>
<p><em>Checked by the EthMultiVault before transacting</em></p>
<pre><code class="language-solidity">function maxAssets() public view override returns (uint256);
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../src/OffsetProgressiveCurve.sol/contract.OffsetProgressiveCurve.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../src/OffsetProgressiveCurve.sol/contract.OffsetProgressiveCurve.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>


    </div>
    </body>
</html>
