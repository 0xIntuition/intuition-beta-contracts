<!DOCTYPE HTML>
<html lang="en" class="dark sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>OffsetProgressiveCurve - Intuition Beta Contracts Documentation</title>


        <!-- Custom HTML head -->
        <!-- Include Mermaid -->
        <script src='https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js'></script>
        
        <!-- Include MathJax -->
        <script>
          window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true, processEnvironments: true }, options: { skipHtmlTags: ['script', 'noscript', 'style',
          'textarea', 'pre'] } };
        </script>
        <script
          type='text/javascript'
          id='MathJax-script'
          async
          src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
        >
        </script>
        
        <script>
          window.addEventListener('load', function() { mermaid.initialize({ startOnLoad: true, theme: 'dark', securityLevel:
          'loose', themeVariables: { darkMode: true }, flowchart: { htmlLabels: true, curve: 'basis', useMaxWidth: true }, zoom:
          { enabled: true, maxZoom: 10, minZoom: 0.1 }, menu: { enabled: true, showMenu: true, menuItems: [ { name: 'Zoom In',
          action: function() { mermaid.mermaidAPI.zoomIn(); } }, { name: 'Zoom Out', action: function() {
          mermaid.mermaidAPI.zoomOut(); } }, { name: 'Reset Zoom', action: function() { mermaid.mermaidAPI.reset(); } } ] } });
          });
        </script>
        
        <style>
          .mermaid { width: 100% !important; } /* Style the menu */ .mermaid-menu { background-color: #2d2d2d !important;
          border: 1px solid #444 !important; padding: 5px !important; border-radius: 4px !important; } .mermaid-menu-item {
          color: #fff !important; padding: 5px 10px !important; cursor: pointer !important; } .mermaid-menu-item:hover {
          background-color: #444 !important; }
        </style>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../book.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Intuition Beta Contracts Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/0xIntuition/intuition-beta-contracts" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="offsetprogressivecurve"><a class="header" href="#offsetprogressivecurve">OffsetProgressiveCurve</a></h1>
<p><a href="https://github.com/0xIntuition/intuition-beta-contracts/blob/3fa150f73a1f1186d143287bdaf448b0d7231227/src/OffsetProgressiveCurve.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/src/BaseCurve.sol/abstract.BaseCurve.html">BaseCurve</a></p>
<p><strong>Author:</strong>
0xIntuition</p>
<p>üöÄ Welcome to the GENTLER version of our Progressive bonding curve! While the ProgressiveCurve
brings the HEAT, the OffsetProgressiveCurve offers a more controlled ascent that's still
rewarding for early stakers. üéØ
This mathematical innovation modifies our progressive pricing model by introducing an offset
that shifts the starting point of our curve. The price follows the formula:
$$P(s) = m \cdot (s + \text{offset})$$
where $m$ is our slope (measured in basis points), $s$ is the total supply of shares, and
$\text{offset}$ is our curve-shifting parameter. The actual cost to mint shares is calculated
as the area under this curve, giving us:
$$\text{Cost} = ((s_2 + \text{offset})^2 - (s_1 + \text{offset})^2) \cdot \frac{m}{2}$$
where $s_1$ is the starting share supply and $s_2$ is the final share supply. üìê
Why is this so clever? üß† By introducing an offset, we can create a more gentle price curve
that still maintains the core benefits of progressive pricing. It's like starting partway up
the curve, which means the initial price increase is less aggressive while still providing
meaningful incentives for early stakers. Think of it as the "smooth operator" version of
our ProgressiveCurve - all the benefits of progressive pricing, but with more control over
the initial trajectory! üé≠
This makes the OffsetProgressiveCurve perfect for scenarios where you want to maintain
the incentive structure of progressive pricing but need more control over the initial
price dynamics. It's the sophisticated sibling to our ProgressiveCurve, offering a more
nuanced approach to value accrual. üé®</p>
<p><em>Uses the prb-math library for performant, precise fixed point arithmetic with UD60x18</em></p>
<p><em>Fixed point precision used for all internal calculations, while return values are all
represented as regular uint256s, and unwrapped.  I.e. we might use 123.456 internally
and return 123.</em></p>
<p><em>The core equation:
$$P(s) = m \cdot (s + \text{offset})$$
and the cost equation:
$$\text{Cost} = ((s_2 + \text{offset})^2 - (s_1 + \text{offset})^2) \cdot \frac{m}{2}$$
comes from calculus - it's the integral of our modified linear price function. The area under
the curve from point $s_1$ to $s_2$ gives us the total cost/return of minting/redeeming
shares, but now shifted by our offset parameter.</em></p>
<p><em>Inspired by the Solaxy.sol contract: https://github.com/M3tering/Solaxy/blob/main/src/Solaxy.sol
and https://m3tering.whynotswitch.com/token-economics/mint-and-distribution.  The key difference
between the Solaxy contract and this one is that the economic state is handled by the EthMultiVault
instead of directly in the curve implementation. The other significant difference is the inclusion
of the OFFSET value, which we use to make the curve more gentle.</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="slope"><a class="header" href="#slope">SLOPE</a></h3>
<p>The slope of the curve, in basis points.  This is the rate at which the price of shares increases.</p>
<p><em>0.0025e18 -&gt; 25 basis points, 0.0001e18 = 1 basis point, etc etc</em></p>
<p><em>If minDeposit is 0.003 ether, this value would need to be 0.00007054e18 to avoid returning 0 shares for minDeposit assets</em></p>
<pre><code class="language-solidity">UD60x18 public immutable SLOPE;
</code></pre>
<h3 id="offset"><a class="header" href="#offset">OFFSET</a></h3>
<p>The offset of the curve.  This value is used to snip off a portion of the beginning of the curve, realigning it to the
origin.  For more details, see the preview functions.</p>
<pre><code class="language-solidity">UD60x18 public immutable OFFSET;
</code></pre>
<h3 id="half_slope"><a class="header" href="#half_slope">HALF_SLOPE</a></h3>
<p>The half of the slope, used for calculations.</p>
<pre><code class="language-solidity">UD60x18 public immutable HALF_SLOPE;
</code></pre>
<h3 id="max_shares"><a class="header" href="#max_shares">MAX_SHARES</a></h3>
<p><em>Since powu(2) will overflow first (see slope equation), maximum totalShares is sqrt(MAX_UD60x18)</em></p>
<pre><code class="language-solidity">uint256 public immutable MAX_SHARES;
</code></pre>
<h3 id="max_assets"><a class="header" href="#max_assets">MAX_ASSETS</a></h3>
<p><em>The maximum assets is totalShares * slope / 2, because multiplication (see slope equation) would overflow beyond that point.</em></p>
<pre><code class="language-solidity">uint256 public immutable MAX_ASSETS;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p>Constructs a new ProgressiveCurve with the given name and slope</p>
<p><em>Computes maximum values given constructor arguments</em></p>
<p><em>Computes Slope / 2 as commonly used constant</em></p>
<pre><code class="language-solidity">constructor(string memory _name, uint256 slope18, uint256 offset18) BaseCurve(_name);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_name</code></td><td><code>string</code></td><td>The name of the curve (i.e. "Progressive Curve #465")</td></tr>
<tr><td><code>slope18</code></td><td><code>uint256</code></td><td>The slope of the curve, in basis points (i.e. 0.0025e18)</td></tr>
<tr><td><code>offset18</code></td><td><code>uint256</code></td><td>The offset of the curve, in basis points (i.e. 0.0001e18)</td></tr>
</tbody></table>
</div>
<h3 id="previewdeposit"><a class="header" href="#previewdeposit">previewDeposit</a></h3>
<p>Preview how many shares would be minted for a deposit of assets</p>
<p><em>Let $s$ = current total supply</em></p>
<p><em>Let $a$ = amount of assets to deposit</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>Let $o$ = offset value</em></p>
<p><em>shares:
$$\text{shares} = \sqrt{(s + o)^2 + \frac{a}{m/2}} - (s + o)$$</em></p>
<p><em>or to say that another way:
$$\text{shares} = \sqrt{(s + o)^2 + \frac{2a}{m}} - (s + o)$$</em></p>
<pre><code class="language-solidity">function previewDeposit(uint256 assets, uint256, uint256 totalShares) public view override returns (uint256 shares);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>Quantity of assets to deposit</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The number of shares that would be minted</td></tr>
</tbody></table>
</div>
<h3 id="previewredeem"><a class="header" href="#previewredeem">previewRedeem</a></h3>
<p>Preview how many assets would be returned for burning a specific amount of shares</p>
<p><em>Let $s$ = initial total supply of shares</em></p>
<p><em>Let $r$ = shares to redeem</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>Let $o$ = offset value</em></p>
<p><em>assets:
$$\text{assets} = ((s + o)^2 - ((s - r + o)^2)) \cdot \frac{m}{2}$$</em></p>
<p><em>this can be expanded to:
$$\text{assets} = ((s + o)^2 - ((s + o)^2 - 2(s + o)r + r^2)) \cdot \frac{m}{2}$$</em></p>
<p><em>which simplifies to:
$$\text{assets} = (2(s + o)r - r^2) \cdot \frac{m}{2}$$</em></p>
<p><em>Implementation note: This formula is computed via the _convertToAssets helper,</em></p>
<p><em>where juniorSupply = (s - r + o) and seniorSupply = (s + o)</em></p>
<pre><code class="language-solidity">function previewRedeem(uint256 shares, uint256 totalShares, uint256) public view override returns (uint256 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>Quantity of shares to burn</td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The number of assets that would be returned</td></tr>
</tbody></table>
</div>
<h3 id="previewmint"><a class="header" href="#previewmint">previewMint</a></h3>
<p>Preview how many assets would be required to mint a specific amount of shares</p>
<p><em>Let $s$ = current total supply of shares</em></p>
<p><em>Let $n$ = new shares to mint</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>Let $o$ = offset value</em></p>
<p><em>assets:
$$\text{assets} = ((s + n + o)^2 - (s + o)^2) \cdot \frac{m}{2}$$</em></p>
<p><em>which can be expanded to:
$$\text{assets} = ((s + o)^2 + 2(s + o)n + n^2 - (s + o)^2) \cdot \frac{m}{2}$$</em></p>
<p><em>which simplifies to:
$$\text{assets} = (2(s + o)n + n^2) \cdot \frac{m}{2}$$</em></p>
<p><em>Implementation note: This formula is computed via the _convertToAssets helper,</em></p>
<p><em>where juniorSupply = (s + o) and seniorSupply = (s + n + o)</em></p>
<pre><code class="language-solidity">function previewMint(uint256 shares, uint256 totalShares, uint256) public view override returns (uint256 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>Quantity of shares to mint</td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The number of assets that would be required to mint the shares</td></tr>
</tbody></table>
</div>
<h3 id="previewwithdraw"><a class="header" href="#previewwithdraw">previewWithdraw</a></h3>
<p>Preview how many shares would be redeemed for a withdrawal of assets</p>
<p><em>Let $s$ = current total supply of shares</em></p>
<p><em>Let $a$ = assets to withdraw</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>Let $o$ = offset value</em></p>
<p><em>shares:
$$\text{shares} = (s + o) - \sqrt{(s + o)^2 - \frac{a}{m/2}}$$</em></p>
<p><em>or to say that another way:
$$\text{shares} = (s + o) - \sqrt{(s + o)^2 - \frac{2a}{m}}$$</em></p>
<pre><code class="language-solidity">function previewWithdraw(uint256 assets, uint256, uint256 totalShares) public view override returns (uint256 shares);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>Quantity of assets to withdraw</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The number of shares that would need to be redeemed</td></tr>
</tbody></table>
</div>
<h3 id="currentprice"><a class="header" href="#currentprice">currentPrice</a></h3>
<p>Get the current price of a share</p>
<p><em>Let $s$ = current total supply of shares</em></p>
<p><em>Let $m$ = the slope of the curve</em></p>
<p><em>Let $o$ = offset value</em></p>
<p><em>sharePrice:
$$\text{sharePrice} = (s + o) \cdot m$$</em></p>
<p><em>This is the modified linear price function where the price increases linearly with the total supply plus offset</em></p>
<p><em>And the slope ($m$) determines how quickly the price increases</em></p>
<p><em>TLDR: Each new share costs more than the last, but starting from an offset point on the curve</em></p>
<pre><code class="language-solidity">function currentPrice(uint256 totalShares) public view override returns (uint256 sharePrice);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sharePrice</code></td><td><code>uint256</code></td><td>The current price of a share</td></tr>
</tbody></table>
</div>
<h3 id="converttoshares"><a class="header" href="#converttoshares">convertToShares</a></h3>
<p>Convert assets to shares at a specific point on the curve</p>
<p><em>Let $s$ = the current total supply of shares</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>Let $a$ = quantity of assets to convert to shares</em></p>
<p><em>Let $o$ = offset value</em></p>
<p><em>shares:
$$\text{shares} = \frac{a}{(s + o) \cdot m/2}$$</em></p>
<p><em>Or to say that another way:
$$\text{shares} = \frac{2a}{(s + o) \cdot m}$$</em></p>
<pre><code class="language-solidity">function convertToShares(uint256 assets, uint256, uint256 totalShares) public view override returns (uint256 shares);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>Quantity of assets to convert to shares</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The number of shares equivalent to the given assets</td></tr>
</tbody></table>
</div>
<h3 id="converttoassets"><a class="header" href="#converttoassets">convertToAssets</a></h3>
<p>Convert shares to assets at a specific point on the curve</p>
<p><em>Let $s$ = current total supply of shares</em></p>
<p><em>Let $\frac{m}{2}$ = half of the slope</em></p>
<p><em>Let $n$ = quantity of shares to convert to assets</em></p>
<p><em>Let $o$ = offset value</em></p>
<p><em>conversion price:
$$\text{price} = (s + o) \cdot \frac{m}{2}$$</em></p>
<p><em>where $\frac{m}{2}$ is average price per share</em></p>
<p><em>assets:
$$\text{assets} = n \cdot ((s + o) \cdot \frac{m}{2})$$</em></p>
<p><em>Or to say that another way:
$$\text{assets} = n \cdot (s + o) \cdot \frac{m}{2}$$</em></p>
<pre><code class="language-solidity">function convertToAssets(uint256 shares, uint256 totalShares, uint256) public view override returns (uint256 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>Quantity of shares to convert to assets</td></tr>
<tr><td><code>totalShares</code></td><td><code>uint256</code></td><td>Total quantity of shares already awarded by the curve</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The number of assets equivalent to the given shares</td></tr>
</tbody></table>
</div>
<h3 id="_converttoassets"><a class="header" href="#_converttoassets">_convertToAssets</a></h3>
<p>Computes assets as the area under a linear curve with a simplified form of the area of a trapezium,
now including the offset:
$$f(x) = m(x + o)$$
$$\text{Area} = \frac{1}{2} \cdot (a + b) \cdot h$$
where $a$ and $b$ can be both $f(\text{juniorSupply})$ or $f(\text{seniorSupply})$ depending if used in minting or redeeming,
and $o$ is the offset value.
Calculates area as:
$$((seniorSupply + offset)^2 - (juniorSupply + offset)^2) \cdot \text{halfSlope}$$
where:
$$\text{halfSlope} = \frac{\text{slope}}{2}$$</p>
<p><em>This method is identical to the ProgressiveCurve because it works entirely with relative values, which are already
offset by the invoking methods.</em></p>
<pre><code class="language-solidity">function _convertToAssets(UD60x18 juniorSupply, UD60x18 seniorSupply) internal view returns (UD60x18 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>juniorSupply</code></td><td><code>UD60x18</code></td><td>The smaller supply in the operation (the initial supply during mint, or the final supply during a redeem operation).</td></tr>
<tr><td><code>seniorSupply</code></td><td><code>UD60x18</code></td><td>The larger supply in the operation (the final supply during mint, or the initial supply during a redeem operation).</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>UD60x18</code></td><td>The computed assets as an instance of UD60x18 (a fixed-point number).</td></tr>
</tbody></table>
</div>
<h3 id="maxshares"><a class="header" href="#maxshares">maxShares</a></h3>
<p>The maximum number of shares that this curve can handle without overflowing.</p>
<p><em>Checked by the EthMultiVault before transacting</em></p>
<pre><code class="language-solidity">function maxShares() public view override returns (uint256);
</code></pre>
<h3 id="maxassets"><a class="header" href="#maxassets">maxAssets</a></h3>
<p>The maximum number of assets that this curve can handle without overflowing.</p>
<p><em>Checked by the EthMultiVault before transacting</em></p>
<pre><code class="language-solidity">function maxAssets() public view override returns (uint256);
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../src/LinearCurve.sol/contract.LinearCurve.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../src/ProgressiveCurve.sol/contract.ProgressiveCurve.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../src/LinearCurve.sol/contract.LinearCurve.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../src/ProgressiveCurve.sol/contract.ProgressiveCurve.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>


    </div>
    </body>
</html>
